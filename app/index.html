<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Koedeam Editor</title>
  <meta name="description" content="声で編む、草稿エディタ（ローカル保存・共有）" />

  <link rel="manifest" href="./manifest.webmanifest" />
  <link rel="icon" href="../assets/icon.svg" type="image/svg+xml" />
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <header class="topbar">
    <a class="brand" href="../">Koedeam</a>
    <div class="top-actions">
      <button id="btnMenu" type="button" class="btn-icon"><span class="icon">☰</span>Menu</button>
    </div>
  </header>

  <div class="layout">
    <main class="main" aria-label="editor area">
      <div class="editor-wrap">
        <div id="caretLine" class="caret-line hidden"></div>
        <div id="caretDot" class="caret-dot hidden"></div>
        <textarea id="editor" placeholder="話して、書いて、整えて、共有。"></textarea>
      </div>
      <div class="status-row">
        <span id="saveStatus">Ready</span>
        <span id="appMessage" aria-live="polite"></span>
      </div>
      <button id="btnExitFocus" type="button" class="focus-exit">Focusを終了</button>
    </main>

    <aside id="sidebar" class="sidebar" aria-label="sidebar">
      <div class="side-head">
        <strong>Sidebar</strong>
        <button id="btnCloseSidebar" type="button" class="btn-icon"><span class="icon">✕</span>Close</button>
      </div>
      <div class="side-tabs" role="tablist" aria-label="sidebar tabs">
        <button type="button" class="tab-btn" data-tab="replace" aria-controls="panelReplace">Replace</button>
        <button type="button" class="tab-btn" data-tab="templates" aria-controls="panelTemplates">Templates</button>
        <button type="button" class="tab-btn" data-tab="history" aria-controls="panelHistory">History</button>
      </div>
      <section id="panelReplace" class="tab-panel" role="tabpanel">
        <h2>検索 / 置換</h2>
        <label>検索語
          <input id="findQuery" type="text" />
        </label>
        <div id="findRecent" class="chip-list"></div>
        <fieldset class="segment">
          <legend>検索オプション</legend>
          <label><input id="optCase" type="checkbox" />大文字/小文字を区別</label>
          <label><input id="optRegex" type="checkbox" />正規表現</label>
        </fieldset>
        <label>置換語
          <input id="replaceQuery" type="text" />
        </label>
        <p id="findStatus">0件</p>
        <div class="dialog-actions wrap">
          <button id="btnFindPrev" type="button">前へ</button>
          <button id="btnFindNext" type="button">次へ</button>
          <button id="btnReplaceOne" type="button">置換</button>
          <button id="btnReplaceNext" type="button">次を置換して次へ</button>
          <button id="btnReplaceAll" type="button">全置換</button>
          <button id="btnReplaceInSelection" type="button">選択範囲のみ全置換</button>
        </div>
      </section>
      <section id="panelTemplates" class="tab-panel" role="tabpanel">
        <h2>Templates</h2>
        <div id="sidebarTemplates" class="sidebar-list"></div>
      </section>
      <section id="panelHistory" class="tab-panel">
        <h2>History</h2>
        <div class="dialog-actions">
          <button id="btnSnapshot" type="button">スナップショット保存</button>
        </div>
        <label>自動スナップショット（分）
          <select id="autoSnapshotSelect">
            <option value="0">OFF</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="5">5</option>
            <option value="10">10</option>
            <option value="15">15</option>
          </select>
        </label>
        <div id="historyList" class="dialog-list dialog-body"></div>
      </section>
    </aside>
  </div>

  <nav class="bottombar" aria-label="tools">
    <button id="btnMic" type="button" class="btn-icon toolbar-item" data-tool="mic"><span class="icon">🎤</span>Mic</button>
    <button id="btnFind" type="button" class="btn-icon toolbar-item" data-tool="find"><span class="icon">🔎</span>Find</button>
    <button id="btnReplace" type="button" class="btn-icon toolbar-item" data-tool="replace"><span class="icon">♻</span>Replace</button>
    <button id="btnTemplates" type="button" class="btn-icon toolbar-item" data-tool="templates"><span class="icon">📄</span>Templates</button>
    <button id="btnHistory" type="button" class="btn-icon toolbar-item" data-tool="history"><span class="icon">🕒</span>History</button>
    <button id="btnEditTools" type="button" class="btn-icon toolbar-item" data-tool="edit"><span class="icon">✎</span>Edit</button>
    <button id="btnShare" type="button" class="btn-icon toolbar-item" data-tool="share"><span class="icon">⇪</span>Share</button>
  </nav>

  <div id="menuOverlay" class="menu-overlay hidden" aria-hidden="true">
    <aside id="menuPanel" class="menu-panel" aria-label="menu">
      <div class="menu-head">
        <strong>Menu</strong>
        <button id="btnCloseMenu" type="button" class="btn-icon"><span class="icon">✕</span>Close</button>
      </div>
      <div class="menu-list">
        <button type="button" class="btn-icon" data-menu="replace"><span class="icon">♻</span>Replace</button>
        <button type="button" class="btn-icon" data-menu="templates"><span class="icon">📄</span>Templates</button>
        <button type="button" class="btn-icon" data-menu="history"><span class="icon">🕒</span>History</button>
        <button type="button" class="btn-icon" data-menu="focus"><span class="icon">◎</span>Focus</button>
        <button type="button" class="btn-icon" data-menu="sidebar"><span class="icon">▤</span>Sidebar</button>
        <button type="button" class="btn-icon" data-menu="settings"><span class="icon">⚙</span>Settings</button>
        <button type="button" class="btn-icon" data-menu="help"><span class="icon">?</span>Help</button>
      </div>
    </aside>
  </div>

  <dialog id="dlgShare">
    <h2>共有</h2>
    <div class="share-mode">
      <button id="btnShareAll" type="button" data-mode="all">全文</button>
      <button id="btnShareSelection" type="button" data-mode="selection">選択範囲</button>
    </div>
    <div class="dialog-actions wrap shortcut-inline">
      <button id="btnNativeShare" type="button" class="btn-icon"><span class="icon">⇪</span>共有</button>
      <button id="btnCopy" type="button">COPY</button>
      <div id="shareShortcutList" class="shortcut-inline-list"></div>
    </div>
    <h3>共有ショートカット</h3>
    <div class="dialog-actions">
      <button id="btnOpenSettingsShare" type="button">ショートカット管理へ</button>
    </div>
    <div class="dialog-footer"><button id="btnCloseShare" type="button">Close</button></div>
  </dialog>

  <dialog id="dlgSettings">
    <h2>設定</h2>
    <div class="side-tabs settings-tabs" role="tablist" aria-label="settings tabs">
      <button type="button" class="tab-btn" data-tab="appearance" aria-controls="panelSettingsAppearance">表示</button>
      <button type="button" class="tab-btn" data-tab="templates" aria-controls="panelSettingsTemplates">テンプレート</button>
      <button type="button" class="tab-btn" data-tab="share" aria-controls="panelSettingsShare">共有ショートカット</button>
      <button type="button" class="tab-btn" data-tab="api" aria-controls="panelSettingsApi">API</button>
    </div>
    <section id="panelSettingsAppearance" class="tab-panel settings-section" role="tabpanel">
      <h3>表示</h3>
      <label>フォントサイズ <span id="fontSizeValue" class="hint"></span>
        <input id="fontSizeRange" type="range" min="12" max="32" step="1" />
      </label>
      <fieldset class="segment">
        <legend>フォントフェイス</legend>
        <label class="radio-sample">
          <input type="radio" name="fontFace" value="sans-jp" />
          <span class="label">サンセリフ（和文）</span>
          <span class="sample font-sans-jp">見出しと本文の例 / 今日は晴れです</span>
        </label>
        <label class="radio-sample">
          <input type="radio" name="fontFace" value="serif-jp" />
          <span class="label">セリフ（和文）</span>
          <span class="sample font-serif-jp">見出しと本文の例 / 今日は晴れです</span>
        </label>
        <label class="radio-sample">
          <input type="radio" name="fontFace" value="sans-en" />
          <span class="label">サンセリフ（英文）</span>
          <span class="sample font-sans-en">The quick brown fox jumps.</span>
        </label>
        <label class="radio-sample">
          <input type="radio" name="fontFace" value="serif-en" />
          <span class="label">セリフ（英文）</span>
          <span class="sample font-serif-en">The quick brown fox jumps.</span>
        </label>
        <label class="radio-sample">
          <input type="radio" name="fontFace" value="mono" />
          <span class="label">等幅</span>
          <span class="sample font-mono">function hello() { return 42; }</span>
        </label>
      </fieldset>
      <fieldset class="segment">
        <legend>編集パネル配置</legend>
        <label><input type="radio" name="editPanelPos" value="bottom" />下</label>
        <label><input type="radio" name="editPanelPos" value="top" />上</label>
        <label><input type="radio" name="editPanelPos" value="left" />左</label>
        <label><input type="radio" name="editPanelPos" value="right" />右</label>
      </fieldset>
      <fieldset class="segment">
        <legend>音声挿入モード</legend>
        <label><input type="radio" name="voiceMode" value="append" />末尾に追記</label>
        <label><input type="radio" name="voiceMode" value="cursor" />カーソル位置に挿入</label>
        <label><input type="radio" name="voiceMode" value="replace" />選択範囲を置換</label>
      </fieldset>
      <fieldset class="segment">
        <legend>ツールバー表示</legend>
        <label><input type="checkbox" data-toolbar="mic" />Mic</label>
        <label><input type="checkbox" data-toolbar="find" />Find</label>
        <label><input type="checkbox" data-toolbar="replace" />Replace</label>
        <label><input type="checkbox" data-toolbar="templates" />Templates</label>
        <label><input type="checkbox" data-toolbar="history" />History</label>
        <label><input type="checkbox" data-toolbar="edit" />Edit</label>
        <label><input type="checkbox" data-toolbar="share" />Share</label>
      </fieldset>
    </section>
    <section id="panelSettingsTemplates" class="tab-panel settings-section">
      <h3>テンプレ</h3>
      <div id="templateList" class="dialog-list dialog-body"></div>
      <form id="templateForm" class="template-form">
        <input id="templateId" type="hidden" />
        <label>名前<input id="templateName" type="text" maxlength="60" required /></label>
        <label>本文<textarea id="templateText" rows="5" required></textarea></label>
        <div class="dialog-actions">
          <button id="btnTemplateSave" type="submit">保存</button>
          <button id="btnTemplateReset" type="button">クリア</button>
        </div>
      </form>
    </section>
    <section id="panelSettingsShare" class="tab-panel settings-section">
      <h3>共有ショートカット</h3>
      <div id="settingsShareList" class="dialog-list dialog-body"></div>
      <form id="shareShortcutForm" class="template-form">
        <input id="shortcutId" type="hidden" />
        <label>名前<input id="shortcutName" type="text" required /></label>
        <label>URLテンプレート<input id="shortcutUrl" type="text" placeholder="mailto:?subject={title}&body={text}" required /></label>
        <div class="dialog-actions">
          <button type="submit">保存</button>
          <button id="btnShortcutReset" type="button">クリア</button>
        </div>
      </form>
    </section>
    <section id="panelSettingsApi" class="tab-panel settings-section">
      <h3>APIキー（端末内保存）</h3>
      <label>OpenAI API Key
        <input id="apiKeyOpenAI" type="password" placeholder="sk-..." />
      </label>
      <label>Other API Key
        <input id="apiKeyOther" type="password" placeholder="任意" />
      </label>
      <p class="hint">キーは端末内のみ保存され、外部送信は行いません。</p>
    </section>
    <div class="dialog-footer"><button id="btnCloseSettings" type="button">Close</button></div>
  </dialog>

  <section id="editToolsPanel" class="edit-tools" aria-label="edit tools">
    <div class="edit-tools-head">
      <strong>編集補助</strong>
      <span class="hint">リアルタイム操作用</span>
    </div>
    <div class="edit-tools-block">
      <div class="edit-group">
        <div class="edit-group-head">カーソル</div>
        <div class="nav-cluster">
          <div class="nav-row">
            <button id="btnLineStart" type="button" class="nav-wide"><span class="icon">|◀</span>行頭</button>
            <button id="btnMoveUp" type="button" class="nav-pad"><span class="icon">▲</span></button>
            <button id="btnLineEnd" type="button" class="nav-wide">行末<span class="icon">▶|</span></button>
          </div>
          <div class="nav-row">
            <button id="btnMoveLeft" type="button" class="nav-pad"><span class="icon">◀</span></button>
            <button id="btnMoveRight" type="button" class="nav-pad"><span class="icon">▶</span></button>
          </div>
          <div class="nav-row">
            <button id="btnSelectParaPrev" type="button" class="nav-wide"><span class="icon">⤒</span>前段落</button>
            <button id="btnMoveDown" type="button" class="nav-pad"><span class="icon">▼</span></button>
            <button id="btnSelectParaNext" type="button" class="nav-wide">次段落<span class="icon">⤓</span></button>
          </div>
        </div>
      <div class="edit-tools-row">
        <button id="btnPuncMode" type="button" class="chip">JP</button>
        <button id="btnComma" type="button"><span class="icon">,</span>カンマ</button>
        <button id="btnPeriod" type="button"><span class="icon">.</span>ピリオド</button>
        <button id="btnNewline" type="button"><span class="icon">↵</span>改行</button>
      </div>
      <div class="edit-tools-row">
        <button id="btnCopySel" type="button"><span class="icon">⎘</span>Copy</button>
        <button id="btnCutSel" type="button"><span class="icon">✂</span>Cut</button>
        <button id="btnPasteSel" type="button"><span class="icon">⎘</span>Paste</button>
      </div>
      </div>
      <div class="edit-group">
        <div class="edit-group-head">範囲選択</div>
        <div class="edit-tools-row">
          <button id="btnSelectLine" type="button"><span class="icon">▭</span>行選択</button>
          <button id="btnSelectBlock" type="button"><span class="icon">▦</span>ブロック</button>
          <button id="btnSelectPara" type="button"><span class="icon">≡</span>段落</button>
          <button id="btnSelectAll" type="button"><span class="icon">▣</span>全選択</button>
        </div>
        <div class="edit-tools-row">
          <button id="btnExpandUp" type="button"><span class="icon">⇑</span>上に拡張</button>
          <button id="btnExpandDown" type="button"><span class="icon">⇓</span>下に拡張</button>
          <button id="btnShrinkDown" type="button"><span class="icon">⇢</span>下を縮小</button>
        </div>
      </div>
    </div>
  </section>

  <dialog id="dlgHelp">
    <h2>Koedeam Help</h2>
    <p>本文は端末内（localStorage）に保存されます。サーバー送信は行いません。</p>
    <p>Web Speech API はブラウザ実装により外部認識サービスが使われる可能性があります。機密文面は OS 音声入力の利用も検討してください。</p>
    <p>共有ショートカットのURLスキームは端末・アプリ仕様に依存します。URLパラメータで本文が入らない場合もあるため、必要に応じてURL編集またはコピー共有を利用してください。</p>
    <ul>
      <li>Mic: 音声入力（非対応時は OS 音声入力を使用）</li>
      <li>Edit: 行/ブロック選択やカーソル移動を補助</li>
      <li>Find/Replace: テキスト検索・置換</li>
      <li>Templates/History/Share: 下書きを素早く再利用・共有</li>
    </ul>
    <div class="dialog-footer"><button id="btnCloseHelp" type="button">Close</button></div>
  </dialog>

  <div id="updateToast" class="toast hidden">
    <span>更新できます</span>
    <button id="btnUpdateApp" type="button">更新</button>
    <button id="btnUpdateLater" type="button">後で</button>
  </div>

  <script src="./app.js"></script>
</body>
</html>
