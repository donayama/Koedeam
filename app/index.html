<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Koedeam - Voice to draft</title>
  <meta name="description" content="声で編む、草稿エディタ（ローカル保存・共有）" />

  <link rel="manifest" href="./manifest.webmanifest" />
  <link rel="icon" href="../assets/icon.svg" type="image/svg+xml" />
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <header class="topbar" aria-label="App Header">
    <button id="btnBrandDocuments" type="button" class="brand" aria-label="ドキュメント一覧を開く"><img src="../assets/icon.svg" alt="" class="brand-icon" />Koedeam</button>
    <div id="statusIndicator" class="status-indicator" aria-live="polite">
      <span id="statusPrimary" class="chip">EDIT</span>
      <span id="statusInput" class="chip">VOICE:OFF</span>
      <span id="statusEdit" class="chip">EDITABLE</span>
      <span id="statusSystem" class="chip">LOCAL</span>
      <span id="statusLayout" class="chip">MOBILE</span>
    </div>
    <div class="top-actions">
      <button id="btnMenu" type="button" class="btn-icon"><span class="icon">☰</span><span class="label">メニュー</span></button>
    </div>
  </header>

  <div class="layout">
    <main class="main" aria-label="editor area">
      <div class="editor-wrap">
        <div id="caretLine" class="caret-line hidden"></div>
        <div id="caretDot" class="caret-dot hidden"></div>
        <textarea id="editor" placeholder="話して、書いて、整えて、共有。"></textarea>
        <div class="status-row">
          <span id="saveStatus">Ready</span>
          <span id="appMessage" aria-live="polite"></span>
        </div>
      </div>
    </main>

    <aside id="sidebar" class="sidebar" aria-label="sidebar">
      <div class="side-head">
        <strong>サイドバー</strong>
        <button id="btnCloseSidebar" type="button" class="btn-icon"><span class="icon">✕</span>Close</button>
      </div>
      <section id="panelTemplates" class="sidebar-section">
        <h3>テンプレ</h3>
        <div class="option-row">
          <label class="option-chip"><input type="radio" name="templateInsertMode" value="cursor" />カーソル位置</label>
          <label class="option-chip"><input type="radio" name="templateInsertMode" value="head" />文頭</label>
          <label class="option-chip"><input type="radio" name="templateInsertMode" value="tail" />文末</label>
        </div>
        <div id="sidebarTemplates" class="sidebar-list"></div>
      </section>
      <section id="panelDocuments" class="sidebar-section hidden">
        <h3>文書一覧</h3>
        <div class="dialog-actions">
          <button id="btnNewDoc" type="button">新規ドキュメント</button>
        </div>
        <div id="documentsList" class="dialog-list dialog-body"></div>
      </section>
      <section id="panelHistory" class="sidebar-section">
        <h3>スナップショット</h3>
        <div class="dialog-actions">
          <button id="btnOpenDocuments" type="button">文書一覧へ</button>
          <button id="btnSnapshot" type="button">スナップショット保存</button>
        </div>
        <label>自動スナップショット（分）
          <select id="autoSnapshotSelect">
            <option value="0">OFF</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="5">5</option>
            <option value="10">10</option>
            <option value="15">15</option>
          </select>
        </label>
        <div id="historyList" class="dialog-list dialog-body"></div>
      </section>
    </aside>
  </div>

  <nav class="bottombar" aria-label="Tool Bar">
    <button id="btnMic" type="button" class="btn-icon toolbar-item" data-tool="mic"><span class="icon">🎤</span>音声入力</button>
    <button id="btnVoiceMode" type="button" class="btn-icon toolbar-item" data-tool="voiceMode"><span class="icon">⌶</span>音声:カーソル</button>
    <button id="btnReplace" type="button" class="btn-icon toolbar-item" data-tool="replace"><span class="icon">🔎</span>検索・置換</button>
    <button id="btnTemplates" type="button" class="btn-icon toolbar-item" data-tool="templates"><span class="icon">📄</span>テンプレ</button>
    <button id="btnHistory" type="button" class="btn-icon toolbar-item" data-tool="history"><span class="icon">🕒</span>スナップショット</button>
    <button id="btnEditTools" type="button" class="btn-icon toolbar-item" data-tool="edit"><span class="icon">✎</span>編集</button>
    <button id="btnShare" type="button" class="btn-icon toolbar-item" data-tool="share"><span class="icon">⇪</span>共有</button>
    <button id="btnOverflow" type="button" class="btn-icon toolbar-overflow" aria-label="その他"><span class="icon">…</span></button>
  </nav>

  <div id="menuOverlay" class="menu-overlay hidden" aria-hidden="true">
    <aside id="menuPanel" class="menu-panel" aria-label="menu">
      <div class="menu-head">
        <strong>メニュー</strong>
        <button id="btnCloseMenu" type="button" class="btn-icon"><span class="icon">✕</span>Close</button>
      </div>
      <div class="menu-list">
        <div id="overflowMenuItems" class="menu-list overflow-menu-items"></div>
        <button type="button" class="btn-icon" data-menu="documents"><span class="icon">🗂</span>文書一覧</button>
        <button type="button" class="btn-icon" data-menu="snapshot"><span class="icon">🕒</span>スナップショット</button>
        <button type="button" class="btn-icon" data-menu="settings"><span class="icon">⚙</span>設定</button>
        <button id="btnOverflowForceReload" type="button" class="btn-icon" data-menu="force-reload"><span class="icon">♻</span>強制リロード</button>
        <button type="button" class="btn-icon" data-menu="help"><span class="icon">?</span>ヘルプ</button>
      </div>
    </aside>
  </div>

  <dialog id="dlgShare">
    <h2>共有</h2>
    <div class="share-mode">
      <button id="btnShareAll" type="button" data-mode="all">全文</button>
      <button id="btnShareSelection" type="button" data-mode="selection">選択範囲</button>
    </div>
    <div class="dialog-actions wrap shortcut-inline">
      <button id="btnNativeShare" type="button" class="btn-icon"><span class="icon">⇪</span>共有</button>
      <button id="btnCopy" type="button">COPY</button>
      <div id="shareShortcutList" class="shortcut-inline-list"></div>
      <button id="btnOpenSettingsShare" type="button" class="btn-icon"><span class="icon">⚙</span>ショートカット管理へ</button>
    </div>
    <div class="dialog-footer"><button id="btnCloseShare" type="button">Close</button></div>
  </dialog>

  <dialog id="dlgSearch">
    <h2>検索・置換</h2>
    <label>検索語
      <input id="findQuery" type="text" />
    </label>
    <div id="findRecent" class="chip-list"></div>
    <fieldset class="segment">
      <legend>検索オプション</legend>
      <label><input id="optCase" type="checkbox" />大文字/小文字を区別</label>
      <label><input id="optRegex" type="checkbox" />正規表現</label>
    </fieldset>
    <label>置換語
      <input id="replaceQuery" type="text" />
    </label>
    <p id="findStatus">0件</p>
    <div class="dialog-actions wrap">
      <button id="btnFindPrev" type="button">前へ</button>
      <button id="btnFindNext" type="button">次へ</button>
      <button id="btnReplaceOne" type="button">置換</button>
      <button id="btnReplaceNext" type="button">次を置換して次へ</button>
      <button id="btnReplaceAll" type="button">全置換</button>
      <button id="btnReplaceInSelection" type="button">選択範囲のみ全置換</button>
    </div>
    <div class="dialog-footer"><button id="btnCloseSearch" type="button">Close</button></div>
  </dialog>

  <dialog id="dlgSettings">
    <!-- WI-104 settings category mapping (move-only, no key changes):
      Voice: voiceMode / voiceContinuous / voiceLang / voiceStartTone / presets / quality compare
      Display: fontSize / fontFace / editPanelPosition / toolbar visibility
      Edit: punctuationMode / candidate settings / undoDepth
      Template: template list + save/reset form
      Share: share shortcut list + save/reset form
      Other: API keys / reset / force reload / field test / telemetry
    -->
    <div class="settings-bar">
      <h2>設定</h2>
      <div class="side-tabs settings-tabs" role="tablist" aria-label="settings tabs">
        <button type="button" class="tab-btn" data-tab="voice" aria-controls="panelSettingsVoice">音声</button>
        <button type="button" class="tab-btn" data-tab="display" aria-controls="panelSettingsDisplay">表示</button>
        <button type="button" class="tab-btn" data-tab="edit" aria-controls="panelSettingsEdit">編集</button>
        <button type="button" class="tab-btn" data-tab="templates" aria-controls="panelSettingsTemplates">テンプレ</button>
        <button type="button" class="tab-btn" data-tab="share" aria-controls="panelSettingsShare">共有</button>
        <button type="button" class="tab-btn" data-tab="other" aria-controls="panelSettingsOther">その他</button>
        <button id="btnCloseSettings" type="button" class="tab-btn settings-close">確定</button>
      </div>
    </div>
    <section id="panelSettingsVoice" class="tab-panel settings-section" role="tabpanel">
      <h3>音声</h3>
      <fieldset class="segment">
        <legend>音声挿入モード</legend>
        <div class="option-row">
          <label class="option-chip"><input type="radio" name="voiceMode" value="append" />末尾</label>
          <label class="option-chip"><input type="radio" name="voiceMode" value="cursor" />カーソル</label>
          <label class="option-chip"><input type="radio" name="voiceMode" value="command" />コマンド</label>
        </div>
      </fieldset>
      <fieldset class="segment">
        <legend>音声認識</legend>
        <p class="hint">連続認識と言語を切り替えます。稼働中に変更した場合は再起動して反映します。</p>
        <div class="option-row">
          <label class="option-chip"><input type="radio" name="voiceContinuous" value="true" />連続ON</label>
          <label class="option-chip"><input type="radio" name="voiceContinuous" value="false" />連続OFF</label>
        </div>
        <div class="option-row">
          <label class="option-chip"><input type="radio" name="voiceLang" value="auto" />言語AUTO</label>
          <label class="option-chip"><input type="radio" name="voiceLang" value="ja-JP" />言語ja-JP</label>
        </div>
        <label class="option-chip"><input id="optVoiceStartTone" type="checkbox" checked />音声開始ガイド音</label>
        <p class="hint">この設定はアプリ内のガイド音にのみ適用されます。ブラウザ/OS標準の開始音は制御できない場合があります。</p>
      </fieldset>
      <fieldset class="segment">
        <legend>音声プリセット</legend>
        <p class="hint">用途別の推奨組み合わせを一括で適用します。必要に応じて後から個別調整できます。</p>
        <div class="option-row">
          <button id="btnVoicePresetWalk" type="button">散歩モード</button>
          <button id="btnVoicePresetFocus" type="button">確定モード</button>
        </div>
      </fieldset>
      <fieldset class="segment">
        <legend>品質比較（4条件）</legend>
        <p class="hint">同じ発話を4条件で比較し、文字数・欠落・語尾消失・停止頻度の差を確認します。</p>
        <div class="option-row">
          <button id="btnVoiceCase1" type="button">1) OFF+AUTO</button>
          <button id="btnVoiceCase2" type="button">2) ON+AUTO</button>
          <button id="btnVoiceCase3" type="button">3) OFF+JA</button>
          <button id="btnVoiceCase4" type="button">4) ON+JA</button>
        </div>
        <label>比較ラベル<input id="voiceEvalLabel" type="text" placeholder="同一音声A-1" /></label>
        <label>期待文字数（任意）<input id="voiceEvalExpectedChars" type="number" min="1" step="1" /></label>
        <label>期待語尾（任意）<input id="voiceEvalExpectedTail" type="text" placeholder="です。" /></label>
      </fieldset>
    </section>
    <section id="panelSettingsDisplay" class="tab-panel settings-section" role="tabpanel">
      <h3>表示</h3>
      <div class="font-row">
        <span class="font-label">サイズ</span>
        <input id="fontSizeRange" type="range" min="12" max="32" step="1" />
        <span id="fontSizeValue" class="hint"></span>
      </div>
      <fieldset class="segment">
        <legend>フォントフェイス</legend>
        <div class="font-face-row">
          <label class="font-chip font-sans-jp">
            <input type="radio" name="fontFace" value="sans-jp" />
            <span>ゴシック</span>
          </label>
          <label class="font-chip font-serif-jp">
            <input type="radio" name="fontFace" value="serif-jp" />
            <span>明朝</span>
          </label>
          <label class="font-chip font-mono">
            <input type="radio" name="fontFace" value="mono" />
            <span>等幅</span>
          </label>
        </div>
      </fieldset>
      <fieldset class="segment">
        <legend>編集パネル配置</legend>
        <div class="option-row">
          <label class="option-chip"><input type="radio" name="editPanelPos" value="bottom" />下</label>
          <label class="option-chip"><input type="radio" name="editPanelPos" value="top" />上</label>
          <label class="option-chip"><input type="radio" name="editPanelPos" value="left" />左</label>
          <label class="option-chip"><input type="radio" name="editPanelPos" value="right" />右</label>
        </div>
      </fieldset>
      <fieldset class="segment">
        <legend>Tool Bar 表示</legend>
        <div id="toolbarOrderList" class="dialog-list dialog-body"></div>
      </fieldset>
    </section>
    <section id="panelSettingsEdit" class="tab-panel settings-section" role="tabpanel">
      <h3>編集</h3>
      <fieldset class="segment">
        <legend>編集ツール表示</legend>
        <div class="option-row">
          <label class="option-chip"><input id="optShowCandidateTools" type="checkbox" checked />候補設定を表示</label>
        </div>
      </fieldset>
      <fieldset class="segment">
        <legend>句読点スタイル</legend>
        <div class="option-row">
          <label class="option-chip"><input type="radio" name="punctuationMode" value="jp" />JP（、。）</label>
          <label class="option-chip"><input type="radio" name="punctuationMode" value="en" />EN（,.）</label>
        </div>
      </fieldset>
      <fieldset class="segment">
        <legend>候補設定</legend>
        <div class="candidate-settings-row">
          <label>候補しきい値<input id="candidateThreshold" type="number" min="0" max="1" step="0.05" value="0.65" /></label>
          <label>信頼値なし<select id="candidateNoConfidenceRule"><option value="show">候補表示</option><option value="direct">即採用</option></select></label>
          <label>放置時<select id="candidateIdleBehavior"><option value="auto">自動採用</option><option value="hold">保留</option></select></label>
        </div>
      </fieldset>
      <fieldset class="segment">
        <legend>履歴</legend>
        <div class="history-settings-row">
          <label>Undo履歴数<input id="undoDepth" type="number" min="1" max="5" step="1" value="3" /></label>
        </div>
      </fieldset>
    </section>
    <section id="panelSettingsTemplates" class="tab-panel settings-section">
      <h3>テンプレ</h3>
      <fieldset class="segment">
        <legend>テンプレ挿入位置（デフォルト）</legend>
        <div class="option-row">
          <label class="option-chip"><input type="radio" name="templateInsertModeSetting" value="cursor" />カーソル位置</label>
          <label class="option-chip"><input type="radio" name="templateInsertModeSetting" value="head" />文頭</label>
          <label class="option-chip"><input type="radio" name="templateInsertModeSetting" value="tail" />文末</label>
        </div>
      </fieldset>
      <div id="templateList" class="dialog-list dialog-body"></div>
      <form id="templateForm" class="template-form">
        <input id="templateId" type="hidden" />
        <label>名前<input id="templateName" type="text" maxlength="60" required /></label>
        <label>本文<textarea id="templateText" rows="5" required></textarea></label>
        <div class="dialog-actions">
          <button id="btnTemplateSave" type="submit">保存</button>
          <button id="btnTemplateReset" type="button">クリア</button>
        </div>
      </form>
    </section>
    <section id="panelSettingsShare" class="tab-panel settings-section">
      <h3>共有</h3>
      <div id="settingsShareList" class="dialog-list dialog-body"></div>
      <form id="shareShortcutForm" class="template-form">
        <input id="shortcutId" type="hidden" />
        <label>名前<input id="shortcutName" type="text" required /></label>
        <label>URLテンプレート<input id="shortcutUrl" type="text" placeholder="mailto:?subject={title}&body={text}" required /></label>
        <p class="hint">凡例：{text} = 本文/選択、{title} = 先頭行、{prompt} = {text} と同義</p>
        <div class="dialog-actions">
          <button type="submit">保存</button>
          <button id="btnShortcutReset" type="button">クリア</button>
        </div>
      </form>
    </section>
    <section id="panelSettingsOther" class="tab-panel settings-section">
      <h3>その他</h3>
      <div class="settings-section">
        <h3>APIキー（端末内保存）</h3>
        <label>OpenAI API Key
          <input id="apiKeyOpenAI" type="password" placeholder="sk-..." />
        </label>
        <label>Other API Key
          <input id="apiKeyOther" type="password" placeholder="任意" />
        </label>
        <p class="hint">キーは端末内のみ保存され、外部送信は行いません。</p>
      </div>
      <div class="settings-section">
        <h3>初期化</h3>
        <button id="btnResetApp" type="button">設定と下書きを初期化</button>
        <p class="hint">この操作は取り消せません。localStorage内のデータを削除します。</p>
      </div>
      <div class="settings-section">
        <h3>強制リロード</h3>
        <button id="btnForceReload" type="button">強制リロード</button>
        <p class="hint">Service Worker とキャッシュを解除して再読み込みします。</p>
      </div>
      <div class="settings-section">
        <h3>Field Test</h3>
        <fieldset class="segment">
          <label class="option-chip"><input id="optFieldTestMode" type="checkbox" />Field Test Mode を有効化</label>
          <p id="fieldTestConsentState" class="hint">同意状態: 未同意</p>
          <button id="btnFieldTestConsent" type="button">同意内容を確認</button>
        </fieldset>
        <label>environment_tag
          <input id="fieldTestEnvironmentTag" type="text" placeholder="local-dev" />
        </label>
        <p class="hint">例: office-a / home / local-dev</p>
        <button id="btnFieldTestExportZip" type="button">Field Test ZIP Export</button>
        <p class="hint">session.json / result.txt / commits.json / meta.md / CONSENT.txt をZIPで出力します。</p>
      </div>
      <div class="settings-section">
        <h3>Telemetry</h3>
        <p class="hint">音声認識セッションの検証ログをJSONとして出力/コピーします。</p>
        <div class="telemetry-tools-row">
          <button id="btnTelemetryExportJson" type="button" class="line-delete"><span class="icon">📥</span>Telemetry JSON</button>
          <button id="btnTelemetryCopyJson" type="button" class="line-delete"><span class="icon">📋</span>Telemetry Copy</button>
        </div>
      </div>
    </section>
  </dialog>

  <dialog id="dlgFieldTestConsent">
    <h3>Field Test 同意</h3>
    <p>Field Test Modeでは、検証目的の動作ログを端末内に保持します。</p>
    <p class="hint">同意後にのみField Test Modeを有効化できます。</p>
    <div class="dialog-actions">
      <button id="btnFieldTestDecline" type="button">同意しない</button>
      <button id="btnFieldTestAgree" type="button">同意して有効化</button>
    </div>
  </dialog>

  <section id="editToolsPanel" class="edit-tools" aria-label="edit tools">
    <div class="edit-tools-head">
      <strong>編集補助</strong>
      <span class="hint">リアルタイム操作用</span>
      <div class="edit-mode-switch" role="tablist" aria-label="Edit Panel mode">
        <button id="btnEditModeNavigation" type="button" class="chip active" data-edit-mode="navigation" role="tab" aria-selected="true">Navigation</button>
        <button id="btnEditModeEdit" type="button" class="chip" data-edit-mode="edit" role="tab" aria-selected="false">Edit</button>
      </div>
    </div>
    <div class="edit-tools-block">
      <div class="edit-group cursor-group" data-edit-mode-group="navigation">
        <button type="button" class="edit-group-head edit-group-toggle" data-section="cursor" aria-expanded="true">
          <span>Navigation: カーソル移動</span><span class="caret">▾</span>
        </button>
        <div class="edit-group-body">
          <div class="edit-grid">
          <div class="edit-row row-1">
            <button id="btnSelectParaPrev" type="button" class="nav-wide"><span class="icon">⤒</span>段落</button>
            <button id="btnMoveUp" type="button" class="nav-pad"><span class="icon">▲</span></button>
            <button id="btnDocStart" type="button"><span class="icon">⏮</span>文頭</button>
          </div>
          <div class="edit-row row-2">
            <button id="btnLineStart" type="button" class="nav-wide icon-only" aria-label="行頭"><span class="icon">|◀</span></button>
            <button id="btnMoveLeft" type="button" class="nav-pad"><span class="icon">◀</span></button>
            <button id="btnMoveRight" type="button" class="nav-pad"><span class="icon">▶</span></button>
            <button id="btnLineEnd" type="button" class="nav-wide icon-only" aria-label="行末"><span class="icon">▶|</span></button>
          </div>
          <div class="edit-row row-3">
            <button id="btnSelectParaNext" type="button" class="nav-wide"><span class="icon">⤓</span>段落</button>
            <button id="btnMoveDown" type="button" class="nav-pad"><span class="icon">▼</span></button>
            <button id="btnDocEnd" type="button"><span class="icon">⏭</span>文末</button>
          </div>
          </div>
        </div>
      </div>
      <div class="edit-group toolbar-group" data-edit-mode-group="edit">
        <button type="button" class="edit-group-head edit-group-toggle" data-section="toolbar" aria-expanded="true">
          <span>Edit: 文字編集</span><span class="caret">▾</span>
        </button>
        <div class="edit-group-body">
          <div class="edit-toolbar-grid">
          <div class="edit-toolbar-main" data-edit-mode-group="edit">
            <button id="btnCopySel" type="button" class="icon-only" aria-label="Copy"><span class="icon">⎘</span></button>
            <button id="btnCutSel" type="button" class="icon-only" aria-label="Cut"><span class="icon">✂</span></button>
            <button id="btnPasteSel" type="button" class="icon-only" aria-label="Paste"><span class="icon">⎘</span></button>
            <button id="btnDelete" type="button" class="icon-only" aria-label="Delete"><span class="icon">⌦</span></button>
            <button id="btnBackspace" type="button" class="icon-only" aria-label="Backspace"><span class="icon">⌫</span></button>
            <button id="btnComma" type="button">、</button>
            <button id="btnPeriod" type="button">。</button>
            <button id="btnNewline" type="button" class="icon-only" aria-label="改行"><span class="icon">↵</span></button>
            <div class="time-menu-wrap" data-edit-mode-group="edit">
              <button id="btnTimeMenu" type="button" class="line-delete"><span class="icon">🕒</span>Time</button>
              <div id="timeMenuPanel" class="time-menu-panel hidden" aria-hidden="true">
                <div class="time-menu-section">
                  <strong>挿入</strong>
                  <button type="button" data-time-action="insert-today">(今日)</button>
                  <button type="button" data-time-action="insert-now">(今)</button>
                  <button type="button" data-time-action="insert-datetime">(日時)</button>
                </div>
                <div class="time-menu-section">
                  <strong>展開</strong>
                  <button type="button" data-time-action="expand-today">日付</button>
                  <button type="button" data-time-action="expand-now">時刻</button>
                  <button type="button" data-time-action="expand-datetime">日時</button>
                </div>
              </div>
            </div>
            <button id="btnUndo" type="button" class="chip">↶ Undo</button>
            <button id="btnRedo" type="button" class="chip">↷ Redo</button>
          </div>
          <div class="line-delete-row" data-edit-mode-group="edit">
            <button id="btnDeleteToLineStart" type="button" class="line-delete"><span class="icon">⌫|</span>行頭まで削除</button>
            <button id="btnDeleteToLineEnd" type="button" class="line-delete"><span class="icon">|⌦</span>行末まで削除</button>
            <button id="btnDeleteLine" type="button" class="line-delete"><span class="icon">⌧</span>行削除</button>
            <button id="btnDeleteParagraph" type="button" class="line-delete"><span class="icon">¶</span>段落削除</button>
          </div>
          <div id="candidatePanel" class="candidate-panel hidden" aria-hidden="true" data-edit-mode-group="edit" data-advanced-group="candidate">
            <strong>候補選択</strong>
            <div id="candidateList" class="candidate-list"></div>
          </div>
          </div>
        </div>
      </div>
      <div class="edit-group range-group" data-edit-mode-group="navigation">
        <button type="button" class="edit-group-head edit-group-toggle" data-section="range" aria-expanded="true">
          <span>Navigation: 範囲選択</span><span class="caret">▾</span>
        </button>
        <div class="edit-group-body">
          <div class="edit-tools-row">
          <button id="btnSelectionClear" type="button"><span class="icon">✕</span>解除</button>
          <button id="btnSelectLine" type="button"><span class="icon">▭</span>行</button>
          <button id="btnSelectPara" type="button"><span class="icon">≡</span>段落</button>
          <button id="btnSelectAll" type="button"><span class="icon">▣</span>全文</button>
        </div>
          <div class="edit-tools-row">
          <button id="btnRangeCutSel" type="button"><span class="icon">✂</span>Cut</button>
          <button id="btnRangePasteSel" type="button"><span class="icon">⎘</span>Paste</button>
          </div>
          <div class="edit-tools-row">
          <button id="btnExpandUp" type="button"><span class="icon">⇑</span>上に拡張</button>
          <button id="btnExpandDown" type="button"><span class="icon">⇓</span>下に拡張</button>
          <button id="btnShrinkUp" type="button"><span class="icon">⇠</span>上を縮小</button>
          <button id="btnShrinkDown" type="button"><span class="icon">⇢</span>下を縮小</button>
          <button id="btnSelectToStart" type="button"><span class="icon">⤒</span>最初まで選択</button>
          <button id="btnSelectToEnd" type="button"><span class="icon">⤓</span>最後まで選択</button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <dialog id="dlgHelp">
    <h2>Koedeam Help</h2>
    <p>本文は端末内（localStorage）に保存されます。サーバー送信は行いません。</p>
    <p>Web Speech API はブラウザ実装により外部認識サービスが使われる可能性があります。機密文面は OS 音声入力の利用も検討してください。</p>
    <p>共有ショートカットのURLスキームは端末・アプリ仕様に依存します。URLパラメータで本文が入らない場合もあるため、必要に応じてURL編集またはコピー共有を利用してください。</p>
    <p id="iosInstallHint" class="hint hidden">iPhone/iPad: 共有メニューから「ホーム画面に追加」でPWAとして使えます。</p>
    <ul>
      <li>Tool Bar: 音声入力/検索・置換/共有の起点</li>
      <li>Edit Panel: 行/ブロック選択やカーソル移動を補助</li>
      <li>Search Panel: テキスト検索・置換</li>
      <li>Snapshot Panel: 履歴保存と復元</li>
    </ul>
    <div class="dialog-actions wrap help-shortcuts">
      <a href="../" target="_blank" rel="noopener" class="btn-icon"><span class="icon">🏠</span>LPを開く</a>
      <a href="./" target="_blank" rel="noopener" class="btn-icon"><span class="icon">↗</span>アプリを新規タブで開く</a>
      <a href="https://github.com/donayama/Koedeam" target="_blank" rel="noopener" class="btn-icon"><span class="icon">⌘</span>GitHub</a>
      <button id="btnHelpInstallPwa" type="button" class="btn-icon" disabled><span class="icon">⬇</span>ホーム画面に追加</button>
    </div>
    <div class="dialog-footer"><button id="btnCloseHelp" type="button">Close</button></div>
  </dialog>

  <div id="updateToast" class="toast hidden">
    <div class="update-toast-main">
      <strong id="updateToastVersion">更新できます</strong>
      <span id="updateToastNote">新しいバージョンを利用できます。</span>
    </div>
    <button id="btnUpdateApp" type="button">更新</button>
    <button id="btnUpdateLater" type="button">後で</button>
  </div>

  <script src="./app.js"></script>
</body>
</html>
