<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Koedeam Editor</title>
  <meta name="description" content="声で編む、草稿エディタ（ローカル保存・共有）" />

  <link rel="manifest" href="./manifest.webmanifest" />
  <link rel="icon" href="../assets/icon.svg" type="image/svg+xml" />
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <header class="topbar">
    <a class="brand" href="../">Koedeam</a>
    <div class="top-actions">
      <button id="btnSidebar" type="button" class="desktop-only">Sidebar</button>
      <button id="btnEditTools" type="button">Edit</button>
      <button id="btnFocus" type="button">Focus</button>
      <button id="btnHelp" type="button">Help</button>
    </div>
  </header>

  <div class="layout">
    <main class="main" aria-label="editor area">
      <textarea id="editor" placeholder="話して、書いて、整えて、共有。"></textarea>
      <div class="status-row">
        <span id="saveStatus">Ready</span>
        <span id="appMessage" aria-live="polite"></span>
      </div>
    </main>

    <aside id="sidebar" class="sidebar" aria-label="sidebar">
      <section>
        <h2>Templates</h2>
        <div id="sidebarTemplates" class="sidebar-list"></div>
      </section>
      <section>
        <h2>History</h2>
        <div id="sidebarHistory" class="sidebar-list"></div>
      </section>
      <section>
        <h2>Share</h2>
        <div id="sidebarShares" class="sidebar-list"></div>
      </section>
    </aside>
  </div>

  <nav class="bottombar" aria-label="tools">
    <button id="btnMic" type="button">Mic</button>
    <button id="btnFind" type="button">Find</button>
    <button id="btnReplace" type="button">Replace</button>
    <button id="btnTemplates" type="button">Templates</button>
    <button id="btnHistory" type="button">History</button>
    <button id="btnShare" type="button">Share</button>
  </nav>

  <dialog id="dlgFindReplace">
    <h2>検索 / 置換</h2>
    <label>検索語
      <input id="findQuery" type="text" />
    </label>
    <div id="findRecent" class="chip-list"></div>
    <fieldset class="segment">
      <legend>検索オプション</legend>
      <label><input id="optCase" type="checkbox" />大文字/小文字を区別</label>
      <label><input id="optRegex" type="checkbox" />正規表現</label>
    </fieldset>
    <label>置換語
      <input id="replaceQuery" type="text" />
    </label>
    <p id="findStatus">0件</p>
    <div class="dialog-actions wrap">
      <button id="btnFindPrev" type="button">前へ</button>
      <button id="btnFindNext" type="button">次へ</button>
      <button id="btnReplaceOne" type="button">置換</button>
      <button id="btnReplaceNext" type="button">次を置換して次へ</button>
      <button id="btnReplaceAll" type="button">全置換</button>
      <button id="btnReplaceInSelection" type="button">選択範囲のみ全置換</button>
      <button id="btnCloseFind" type="button">Close</button>
    </div>
  </dialog>

  <dialog id="dlgTemplates">
    <h2>テンプレ管理</h2>
    <div id="templateList" class="dialog-list"></div>
    <form id="templateForm" class="template-form">
      <input id="templateId" type="hidden" />
      <label>名前<input id="templateName" type="text" maxlength="60" required /></label>
      <label>本文<textarea id="templateText" rows="5" required></textarea></label>
      <div class="dialog-actions">
        <button id="btnTemplateSave" type="submit">保存</button>
        <button id="btnTemplateReset" type="button">クリア</button>
      </div>
    </form>
    <div class="dialog-actions"><button id="btnCloseTemplates" type="button">Close</button></div>
  </dialog>

  <dialog id="dlgHistory">
    <h2>履歴</h2>
    <div class="dialog-actions">
      <button id="btnSnapshot" type="button">スナップショット保存</button>
    </div>
    <label>自動スナップショット（分）
      <select id="autoSnapshotSelect">
        <option value="0">OFF</option>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="5">5</option>
        <option value="10">10</option>
        <option value="15">15</option>
      </select>
    </label>
    <div id="historyList" class="dialog-list"></div>
    <div class="dialog-actions"><button id="btnCloseHistory" type="button">Close</button></div>
  </dialog>

  <dialog id="dlgShare">
    <h2>共有</h2>
    <div class="share-mode">
      <button id="btnShareAll" type="button" data-mode="all">全文</button>
      <button id="btnShareSelection" type="button" data-mode="selection">選択範囲</button>
    </div>
    <div class="dialog-actions wrap">
      <button id="btnNativeShare" type="button">Share API</button>
      <button id="btnCopy" type="button">Copy</button>
      <button id="btnCut" type="button">Cut</button>
      <button id="btnPaste" type="button">Paste</button>
      <button id="btnNormalize" type="button">改行統一LF</button>
      <button id="btnCompressBlank" type="button">空行圧縮</button>
    </div>
    <h3>共有ショートカット</h3>
    <div id="shareShortcutList" class="dialog-list"></div>
    <form id="shareShortcutForm" class="template-form">
      <input id="shortcutId" type="hidden" />
      <label>名前<input id="shortcutName" type="text" required /></label>
      <label>URLテンプレート<input id="shortcutUrl" type="text" placeholder="mailto:?subject={title}&body={text}" required /></label>
      <div class="dialog-actions">
        <button type="submit">保存</button>
        <button id="btnShortcutReset" type="button">クリア</button>
      </div>
    </form>
    <div class="dialog-actions"><button id="btnCloseShare" type="button">Close</button></div>
  </dialog>

  <dialog id="dlgEditTools">
    <h2>編集補助</h2>
    <p class="hint">スマホ/タブレットでの選択や移動を補助します。</p>
    <fieldset class="segment">
      <legend>音声挿入モード</legend>
      <label><input type="radio" name="voiceMode" value="append" />末尾に追記</label>
      <label><input type="radio" name="voiceMode" value="cursor" />カーソル位置に挿入</label>
      <label><input type="radio" name="voiceMode" value="replace" />選択範囲を置換</label>
    </fieldset>
    <div class="dialog-actions wrap">
      <button id="btnSelectLine" type="button">行を選択</button>
      <button id="btnSelectBlock" type="button">ブロック選択</button>
      <button id="btnSelectPara" type="button">段落選択</button>
      <button id="btnSelectParaPrev" type="button">前の段落へ</button>
      <button id="btnSelectParaNext" type="button">次の段落へ</button>
      <button id="btnExpandUp" type="button">上に1行拡張</button>
      <button id="btnExpandDown" type="button">下に1行拡張</button>
      <button id="btnShrinkDown" type="button">下を1行縮める</button>
      <button id="btnSelectAll" type="button">全選択</button>
      <button id="btnLineStart" type="button">行頭へ</button>
      <button id="btnLineEnd" type="button">行末へ</button>
      <button id="btnMoveUp" type="button">上の行へ</button>
      <button id="btnMoveDown" type="button">下の行へ</button>
    </div>
    <div class="dialog-actions"><button id="btnCloseEdit" type="button">Close</button></div>
  </dialog>

  <dialog id="dlgHelp">
    <h2>Koedeam Help</h2>
    <p>本文は端末内（localStorage）に保存されます。サーバー送信は行いません。</p>
    <p>Web Speech API はブラウザ実装により外部認識サービスが使われる可能性があります。機密文面は OS 音声入力の利用も検討してください。</p>
    <p>共有ショートカットのURLスキームは端末・アプリ仕様に依存します。URLパラメータで本文が入らない場合もあるため、必要に応じてURL編集またはコピー共有を利用してください。</p>
    <ul>
      <li>Mic: 音声入力（非対応時は OS 音声入力を使用）</li>
      <li>Edit: 行/ブロック選択やカーソル移動を補助</li>
      <li>Find/Replace: テキスト検索・置換</li>
      <li>Templates/History/Share: 下書きを素早く再利用・共有</li>
    </ul>
    <button id="btnCloseHelp" type="button">Close</button>
  </dialog>

  <div id="updateToast" class="toast hidden">
    <span>更新できます</span>
    <button id="btnUpdateApp" type="button">更新</button>
    <button id="btnUpdateLater" type="button">後で</button>
  </div>

  <script src="./app.js"></script>
</body>
</html>
